{"version":3,"sources":["webpack:///webpack/bootstrap 070f86bce802770c7e21","webpack:///./src/index.js","webpack:///./src/dots.js","webpack:///./src/matrix.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;AC7DA;AAAA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C;;;;;;;;;;;AC9NC;;AAED;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA,wBAAwB,iBAAiB;AACzC;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA,iBAAiB,mBAAmB;AACpC;AACA;;AAEA;AACA;AACA;;AAEA,iBAAiB,oBAAoB;AACrC;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;;;;;;;ACxIA;AAAA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,qCAAqC,OAAO;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,iCAAiC,OAAO;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 070f86bce802770c7e21","//\n\nimport * as dots from './dots';\n\nvar effectCanvas = document.querySelector('canvas');\nvar effectContext = effectCanvas.getContext('2d');\n\n//var __image;\nvar image;\n\nvar video = document.createElement('video');\n\nvar videoCanvas = document.createElement('canvas');\nvar videoContext = videoCanvas.getContext('2d');\n\neffectContext.imageSmoothingEnabled = false;\n/*\naddEventListener('resize', onResize, false);\n\nfunction onResize() {\n  effectCanvas.width = effectCanvas.offsetWidth;\n  effectCanvas.height = effectCanvas.offsetHeight;\n};\n\nonResize();\n//*/\nreadCamera();\n//readImage(\"assets/basic.png\");\n\nfunction animationFrame() {\n  requestAnimationFrame(animationFrame);\n\n  videoContext.clearRect(0, 0, videoCanvas.width, videoCanvas.height);\n  (!image) ?\n    videoContext.drawImage(video, 0, 0) : videoContext.putImageData(image, 0, 0);\n\n  var videoData = videoContext.getImageData(0, 0, videoCanvas.width, videoCanvas.height);\n\n  var rotateY = -(mouseX - window.innerWidth / 2) / window.innerWidth * 100;\n  var rotateX = (mouseY - window.innerHeight / 2) / window.innerHeight * 100;\n\n  //\n\n  var effectData = dots.calc(videoData, effectCanvas.width, effectCanvas.height, rotateX, rotateY);\n\n  effectContext.clearRect(0, 0, effectContext.width, effectContext.height);\n  effectContext.putImageData(effectData, 0, 0);\n\n  //effectContext.putImageData(image, 0, 0);\n\n}\n\nfunction start() {\n  dots.init(effectContext);\n  animationFrame();\n}\n\n// aux\n\n\nfunction readImage1(src) {\n  var inputImage = new Image();\n  inputImage.src = src;\n  inputImage.onload = () => {\n\n\n    var imageWidth = inputImage.width;\n    var imageHeight = inputImage.height;\n\n    var canvas = document.createElement('canvas');\n    canvas.width = imageWidth;\n    canvas.height = imageHeight;\n\n    var context = canvas.getContext('2d');\n    context.drawImage(inputImage, 0, 0, inputImage.width, inputImage.height,\n      0, 0, effectCanvas.offsetWidth, effectCanvas.offsetHeight);\n\n    image = context.getImageData(0, 0, effectCanvas.offsetWidth, effectCanvas.offsetHeight);\n\n    effectCanvas.width = imageWidth;\n    effectCanvas.height = imageHeight;\n    videoCanvas.width = imageWidth;\n    videoCanvas.height = imageHeight;\n\n    start();\n  };\n}\n\nfunction readImage(src) {\n  var inputImage = new Image();\n  inputImage.src = src;\n  inputImage.onload = () => {\n    var imageWidth = inputImage.width;\n    var imageHeight = inputImage.height;\n\n    var canvas = document.createElement('canvas');\n    canvas.width = imageWidth\n    canvas.height = imageHeight;\n\n    var context = canvas.getContext('2d');\n    context.drawImage(inputImage, 0, 0);\n    image = context.getImageData(0, 0, imageWidth, imageHeight);\n\n    effectCanvas.width = imageWidth;\n    effectCanvas.height = imageHeight;\n    videoCanvas.width = imageWidth;\n    videoCanvas.height = imageHeight;\n\n    start();\n  };\n}\n\nfunction readCamera() {\n  navigator.mediaDevices.getUserMedia({\n    video: {\n      //     width: 1280,\n      //    height: 720\n      width: 640,\n      height: 320\n    }\n  })\n    .then((stream) => {\n      video.srcObject = stream;\n      video.play();\n    })\n    .catch((e) =>\n      console.warn(e)\n    );\n\n  video.addEventListener('loadedmetadata', function () {\n    effectCanvas.width = video.videoWidth;\n    effectCanvas.height = video.videoHeight;\n    videoCanvas.width = video.videoWidth;\n    videoCanvas.height = video.videoHeight;\n\n    scaleCanvas(effectContext);\n    scaleCanvas(videoContext);\n\n    start();\n  });\n}\n\nvar zone = document.querySelector('.container');\nzone.addEventListener('drop', onImageDrop, false);\nzone.addEventListener('dragenter', (e) => e.preventDefault());\nzone.addEventListener('dragover', (e) => e.preventDefault());\n\nfunction onImageDrop(event) {\n  event.stopPropagation();\n  event.preventDefault();\n\n  var dt = event.dataTransfer;\n  var files = dt.files;\n\n  var file = files[0];\n\n  if (file.type.match(/^image/)) {\n    console.log(file);\n    var reader = new FileReader();\n    reader.onload = function (e) {\n      readImage(e.target.result)\n    }\n    reader.readAsDataURL(file);\n  } else {\n    console.warn('Incorrect file type:', file.name, file.type);\n  }\n}\n\nfunction scaleCanvas(context) {\n  let devicePixelRatio = window.devicePixelRatio || 1;\n  let backingStoreRatio = context.webkitBackingStorePixelRatio ||\n    context.mozBackingStorePixelRatio ||\n    context.msBackingStorePixelRatio ||\n    context.oBackingStorePixelRatio ||\n    context.backingStorePixelRatio || 1;\n\n  let ratio = devicePixelRatio / backingStoreRatio;\n\n  if (devicePixelRatio !== backingStoreRatio) {\n    var canvas = context.canvas;\n    canvas.style.width = canvas.width + 'px';\n    canvas.style.height = canvas.height + 'px';\n\n    canvas.width = canvas.width * ratio;\n    canvas.height = canvas.height * ratio;\n\n    context.scale(ratio, ratio);\n  }\n}\n\n// ctrl\n\nwindow.addEventListener('mousemove', onMouseMove, false);\n\nvar mouseX = 0;\nvar mouseY = 0;\n\nfunction onMouseMove(event) {\n  mouseX = event.clientX;\n  mouseY = event.clientY;\n}\n\nwindow.addEventListener('keydown', onKeyDown, false);\n\nvar rmode = 0;\nvar rscale = 0.5;\n\nfunction onKeyDown(event) {\n  if (event.keyCode == 37) {\n    rmode = (4 + rmode - 1) % 4;\n    dots.sset(rmode, rscale);\n  }\n  if (event.keyCode == 39) {\n    rmode = (4 + rmode + 1) % 4;\n    dots.sset(rmode, rscale);\n  }\n  if (event.keyCode == 38) {\n    rscale += 0.05;\n    dots.sset(rmode, rscale);\n  }\n  if (event.keyCode == 40) {\n    rscale -= 0.05;\n    dots.sset(rmode, rscale);\n  }\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/index.js\n// module id = 0\n// module chunks = 0","import {\n  Matrix3D\n} from './matrix';\n\nvar matrix = new Matrix3D();\n\nvar imageData;\n\nvar buf;\nvar buf8;\nvar zbuf;\nvar zbuf8;\nvar pixels;\n\nfunction init(context) {\n  imageData = context.getImageData(0, 0, context.canvas.width, context.canvas.height);\n\n  buf = new ArrayBuffer(imageData.data.length);\n  buf8 = new Uint8ClampedArray(buf);\n  zbuf = new ArrayBuffer(imageData.data.length);\n  zbuf8 = new Uint8ClampedArray(zbuf);\n\n  pixels = new Uint32Array(buf);\n}\n\nvar SCALE = 1;\nvar DEPTH = .5;\nvar RENDER_MODE = 3;\n\nfunction sset(render, depth) {\n  DEPTH = depth;\n  RENDER_MODE = render;\n}\n\nfunction calc(image, width, height, rotateX, rotateY) {\n  var buff = new Uint32Array(image.data.buffer);\n  var vectors = new Int32Array(width * height * 3);\n\n  // create\n\n  var color;\n  var R, G, B, Y;\n\n  for (var i = 0, j = 0; i < buff.length; i++) {\n    color = buff[i];\n\n    R = (color >> 16) & 0xFF;\n    G = (color >> 8) & 0xFF;\n    B = (color) & 0xFF;\n\n    // ITU BT.709 defines color luminance as\n    //   Y = 0.2126 R + 0.7152 G + 0.0722 B\n    // Here we use a fast approximation which translates to:\n    //   Y = 0.3750 R + 0.5000 G + 0.1250 B\n    // [source: https://stackoverflow.com/questions/596216]\n    Y = (R + R + R + G + G + G + G + B >> 3) * DEPTH;\n\n    vectors[j++] = i % width * SCALE | 0;\n    vectors[j++] = i / width * SCALE | 0;\n    vectors[j++] = -Y * SCALE | 0;\n  }\n\n  // calculate\n\n  var axisX = {\n    x: 1,\n    y: 0,\n    z: 0\n  };\n  var axisY = {\n    x: 0,\n    y: 1,\n    z: 0.15\n  };\n  var pivot = {\n    x: (width / 2) * SCALE,\n    y: (height / 2) * SCALE\n  };\n\n  matrix.identity();\n  matrix.rotate(rotateX, axisX, pivot);\n  matrix.rotate(rotateY, axisY, pivot);\n  matrix.transform(vectors);\n\n  // invalidate\n\n  var SHADE = 0x333333;\n  var MAXCOLOR = 0xFFFFFF - SHADE;\n\n  for (var i = 0; i < pixels.length; i++) {\n    pixels[i] = 0xFF << 24;\n  }\n\n  var c;\n  var cz;\n  var cc;\n\n  for (var i = 0; i < vectors.length; i += 3) {\n    var x = vectors[i * 3] | 0;\n    var y = vectors[i * 3 + 1] | 0;\n    var xyi = (x + y * width);\n\n    if (x >= width || x < 0 || y >= height || y < 0) {\n      continue;\n    }\n\n    if (RENDER_MODE == 5) {\n      pixels[xyi] = buff[i];\n    }\n    if (RENDER_MODE == 1) {\n      cz = vectors[i * 3 + 2];\n      cc = pixels[xyi] & 0xFFFFFF;\n      pixels[xyi] = cc < MAXCOLOR ? cc + SHADE : MAXCOLOR;\n    }\n    if (RENDER_MODE == 2) {\n      cz = vectors[i * 3 + 2];\n      c = 16 - cz / 100 * 8;\n      cc = pixels[xyi];\n      R = Math.max(0, Math.min(0x9F, c + ((cc >> 16) & 0xFF)));\n      G = Math.max(0, Math.min(0x9F, c + ((cc >> 8) & 0xFF)));\n      B = Math.max(0, Math.min(0x9F, c + ((cc) & 0xFF)));\n      pixels[xyi] = (0xFF << 24 | R << 16 | G << 8 | B);\n    }\n    if (RENDER_MODE == 3) {\n      c = buff[i];\n      cc = pixels[xyi];\n      R = Math.max(0, Math.min(0xFF, ((c >> 16) & 0xFF) + ((cc >> 16) & 0xFF)));\n      G = Math.max(0, Math.min(0xFF, ((c >> 8) & 0xFF) + ((cc >> 8) & 0xFF)));\n      B = Math.max(0, Math.min(0xFF, ((c) & 0xFF) + ((cc) & 0xFF)));\n      pixels[xyi] = (0xFF << 24 | R << 16 | G << 8 | B);\n    }\n  }\n\n  imageData.data.set(buf8);\n\n  return imageData;\n}\n\nexport {\n  init,\n  sset,\n  calc\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/dots.js\n// module id = 1\n// module chunks = 0","function Matrix3D() {\n  // set default values\n  this.identity();\n}\n\nMatrix3D.prototype.identity = function () {\n  this.m11 = 1;\n  this.m12 = 0;\n  this.m13 = 0;\n  this.m14 = 0;\n  this.m21 = 0;\n  this.m22 = 1;\n  this.m23 = 0;\n  this.m24 = 0;\n  this.m31 = 0;\n  this.m32 = 0;\n  this.m33 = 1;\n  this.m34 = 0;\n  this.m41 = 0;\n  this.m42 = 0;\n  this.m43 = 0;\n  this.m44 = 1;\n};\n\nMatrix3D.prototype.rotate = function (degrees, axis, pivot) {\n  var tx = pivot.x || 0;\n  var ty = pivot.y || 0;\n  var tz = pivot.z || 0;\n\n  var cos = Math.cos(degrees * Math.PI / 180);\n  var sin = Math.sin(degrees * Math.PI / 180);\n\n  var x = axis.x || 0;\n  var y = axis.y || 0;\n  var z = axis.z || 0;\n\n  var x2 = x * x;\n  var y2 = y * y;\n  var z2 = z * z;\n\n  var l2 = x2 + y2 + z2;\n\n  // normalize\n\n  var l = Math.sqrt(l2);\n  x /= l;\n  y /= l;\n  z /= l;\n  x2 /= l2;\n  y2 /= l2;\n  z2 /= l2;\n\n  // cache matrix\n\n  //  var a11 = this.m11;\n  //  var a12 = this.m12;\n  //  var a13 = this.m13;\n  //  var a14 = this.m14;\n  //  var a21 = this.m21;\n  var a22 = this.m22;\n  var a23 = this.m23;\n  var a24 = this.m24;\n  //  var a31 = this.m31;\n  var a32 = this.m32;\n  var a33 = this.m33;\n  var a34 = this.m34;\n\n  // rotation matrix\n\n  var b11 = x2 + (y2 + z2) * cos;\n  var b12 = x * y * (1 - cos) - z * sin;\n  var b13 = x * z * (1 - cos) + y * sin;\n  var b14 = (tx * (y2 + z2) - x * (ty * y + tz * z)) * (1 - cos) + (ty * z - tz * y) * sin;\n  var b21 = x * y * (1 - cos) + z * sin;\n  var b22 = y2 + (x2 + z2) * cos;\n  var b23 = y * z * (1 - cos) - x * sin;\n  var b24 = (ty * (x2 + z2) - y * (tx * x + tz * z)) * (1 - cos) + (tz * x - tx * z) * sin;\n  var b31 = x * z * (1 - cos) - y * sin;\n  var b32 = y * z * (1 - cos) + x * sin;\n  var b33 = z2 + (x2 + y2) * cos;\n  var b34 = (tz * (x2 + y2) - z * (tx * x + ty * y)) * (1 - cos) + (tx * y - ty * x) * sin;\n\n  // mult\n\n  this.m11 = b11;\n  this.m21 = a22 * b21 + a23 * b31;\n  this.m31 = a32 * b21 + a33 * b31;\n  this.m41 = 0;\n  this.m12 = b12;\n  this.m22 = a22 * b22 + a23 * b32;\n  this.m32 = a32 * b22 + a33 * b32;\n  this.m42 = 0;\n  this.m13 = b13;\n  this.m23 = a22 * b23 + a23 * b33;\n  this.m33 = a32 * b23 + a33 * b33;\n  this.m43 = 0;\n  this.m14 = b14;\n  this.m24 = a22 * b24 + a23 * b34 + a24;\n  this.m34 = a32 * b24 + a33 * b34 + a34;\n  this.m44 = 1;\n};\n\nMatrix3D.prototype.transform = function (vectors) {\n  for (var i = 0, l = vectors.length; i < l; i += 3) {\n    var x = vectors[i + 0];\n    var y = vectors[i + 1];\n    var z = vectors[i + 2];\n    vectors[i + 0] = this.m11 * x + this.m12 * y + this.m13 * z + this.m14;\n    vectors[i + 1] = this.m21 * x + this.m22 * y + this.m23 * z + this.m24;\n    vectors[i + 2] = this.m31 * x + this.m32 * y + this.m33 * z + this.m34;\n  }\n}\n\nMatrix3D.prototype.transformVectors2 = function (vin, vout) {\n  var m11 = this.m11;\n  var m12 = this.m12;\n  var m13 = this.m13;\n  var m14 = this.m14;\n  var m21 = this.m21;\n  var m22 = this.m22;\n  var m23 = this.m23;\n  var m24 = this.m24;\n  var m31 = this.m31;\n  var m32 = this.m32;\n  var m33 = this.m33;\n  var m34 = this.m34;\n\n  for (var i = 0, l = vin.length; i < l; i += 3) {\n    var x = vin[i + 0];\n    var y = vin[i + 1];\n    var z = vin[i + 2];\n    vout[i + 0] = m11 * x + m12 * y + m13 * z + m14;\n    vout[i + 1] = m21 * x + m22 * y + m23 * z + m24;\n    vout[i + 2] = m31 * x + m32 * y + m33 * z + m34;\n  }\n};\n\nexport {\n  Matrix3D\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/matrix.js\n// module id = 2\n// module chunks = 0"],"sourceRoot":""}